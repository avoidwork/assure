/*
 2013 Jason Mulligan
 @license BSD-3 <https://raw.github.com/avoidwork/assure/master/LICENSE>
 @link https://github.com/avoidwork/assure
 @module assure
 @version 0.0.1
*/
(function(p){function l(){this.childNodes=[];this.error=[];this.fulfill=[];this.outcome=this.parentNode=null;this.state=a.state.pending}var a={factory:function(){return new l},freeze:"function"===typeof Object.freeze,methods:{reject:function(c){var e=this;setTimeout(function(){a.resolve.call(e,a.state.broken,c)},0);return this},resolve:function(c){var e=this;setTimeout(function(){a.resolve.call(e,a.state.resolved,c)},0);return this},resolved:function(){return this.state===a.state.broken||this.state===
a.state.resolved},then:function(c,e){var d=this,g=a.factory(),h;h=function(f){var h=f?c:e;f=f?!1:!0;var b;try{b=h.call(void 0,d.outcome),f=!1}catch(m){b=m,f=!0,void 0!==b&&!(b instanceof Error)&&("object"===typeof b&&(b=JSON.stringify(b)),b=Error(b))}finally{if(b instanceof l)d.state=a.state.pending,d.outcome=null,b.parentNode=d,b.then(function(a){d.childNodes.forEach(function(b){b.resolve(a)})},function(a){d.childNodes.forEach(function(b){b.reject(a)})});else{if(f&&void 0===b)throw Error("Invalid arguments");
g[!f?"resolve":"reject"](b||d.outcome)}return b}};"function"===typeof c&&a.vouch.call(d,a.state.resolved,function(){return h(!0)});"function"===typeof e&&a.vouch.call(d,a.state.broken,function(){return h(!1)});g.parentNode=d;d.childNodes.push(g);return g}},resolve:function(c,e){var d=c===a.state.broken?"error":"fulfill",g=this,h=!1,f=!1,n=[],b,m,k;if(this.state!==a.state.pending){if(null!==this.parentNode&&this.parentNode.state===a.state.resolved||0<this.childNodes.length)return;throw Error("The promise has been resolved: {{outcome}}".replace("{{outcome}}",
this.outcome));}this.state=c;this.outcome=e;this[d].forEach(function(b,d){k=b.call(g,e);n.push(d);if(k instanceof l)return h=!0,g.outcome=null,g.state=a.state.pending,!1;k instanceof Error&&(f=!0,m=k,c=a.state.broken)});if(h){for(b=n.length;b--;)g[d].splice(b,1);return k}this.error=[];this.fulfill=[];f||(k=m,c=a.state.resolved);if(null!==this.parentNode&&this.parentNode.state===a.state.pending)this.parentNode[c===a.state.resolved?"resolve":"reject"](k||this.outcome);a.freeze&&Object.freeze(this);
return this},state:{broken:"rejected",pending:"pending",resolved:"fulfilled"},vouch:function(c,e){if(""===c)throw Error("Invalid arguments");this.state===a.state.pending?this[c===a.state.resolved?"fulfill":"error"].push(e):this.state===c&&e(this.outcome);return this}};l.prototype=a.methods;l.prototype.constructor=l;"undefined"!==typeof exports?module.exports=a.factory:"function"===typeof define?define(function(){return a.factory}):p.assure=a.factory})(this);
//@ sourceMappingURL=assure.map
